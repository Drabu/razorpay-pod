name: Test Clone Private Repo
on:
  push:
jobs:
  Run-Unit-Test:
    runs-on: macOS-latest # nosemgrep : non-self-hosted-runner
    steps:
      - name: Select Xcode
        run: sudo xcode-select -switch /Applications/Xcode.app/Contents/Developer

      - name: Xcode Version
        run: /usr/bin/xcodebuild -version

      - name: Check out razorpay-ios repository code
        uses: actions/checkout@v2
        with:
          repository: "razorpay/razorpay-ios"
          token: "${{ secrets.CI_BOT_TOKEN }}"
          ref: codeCoverage

      - name: Set permission
        run: exec chmod +x ./.github/scripts/run-uts.sh
      - name: Running Standard Checkout Unit Tests
        run: exec ./.github/scripts/run-uts.sh

      - name: Set permission to run XCFramework Script
        run: exec chmod +x ./.github/scripts/create-standard-checkout-build.sh
      - name: Run Create XCFramework Script
        run: exec ./.github/scripts/create-standard-checkout-build.sh

      - name: Check out razorpay-pod repository code
        uses: actions/checkout@v2
        with:
          repository: "razorpay/razorpay-pod"
          token: "${{ secrets.CI_BOT_TOKEN }}"

      - name: Remove old Build
        run: rm -rf ./Pod/Razorpay.xcframework

      - name: Commit Changes
        uses: EndBug/add-and-commit@v9
        with:
          author_name: Ramprasad A
          author_email: ramprasad.a@razorpay.com
          message: Test Commit RM File
          new_branch: iOSAutomation
          add: ./Pod
          push: origin iOSAutomation --set-upstream --force
